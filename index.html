<!DOCTYPE html>
<html>
<head>
    <title>Twilio Browser Calls</title>

</head>
<body>
    <input type="number" id="phoneNumber" placeholder="Phone Number">
    <input type="text" id="token" placeholder="Enter JWT Token">
    <button onclick="test()">Test Token</button>
    <button onclick="makeCall()">Make Call</button>
    <button onclick="hangUp()">Hang Up</button>
    <div id="status">Ready</div>
    <script src="twilio.js"></script>
    <script>
        
function test(){
    var accessToken = document.getElementById("token").value; // Get access token from your server
    // Initialize Twilio.Device
const device = new Twilio.Device();

// Event listeners using EventEmitter
device.on('ready', function(device) {
    console.log('Twilio.Device Ready');
});

device.on('error', function(error) {
    console.error('Twilio.Device Error:', error.message);
});

device.on('offline', function(device) {
    console.log('Twilio.Device Offline');
});

device.on('incoming', function(connection) {
    console.log('Incoming connection from ' + connection.parameters.From);
    // Accept the incoming connection if desired
    // connection.accept();
});

device.on('cancel', function(connection) {
    console.log('Cancelled incoming connection from ' + connection.parameters.From);
});

device.on('connect', function(connection) {
    console.log('Connected to ' + connection.parameters.To);
});

device.on('disconnect', function(connection) {
    console.log('Disconnected from ' + connection.parameters.To);
});

Twilio.Device.setup(accessToken);

    Twilio.Device.ready(function(device) {
    document.getElementById('status').innerText = 'Ready';
    });

    Twilio.Device.error(function(error) {
        document.getElementById('status').innerText = 'Error: ' + error.message;
    });

    Twilio.Device.connect(function(conn) {
        document.getElementById('status').innerText = 'Connected';
    });

    Twilio.Device.disconnect(function(conn) {
        document.getElementById('status').innerText = 'Disconnected';
    });


    
}


function makeCall() {
    
    var params = {
        To: document.getElementById("phoneNumber").value
    };
    Twilio.Device.connect(params);
}

function hangUp() {
    Twilio.Device.disconnectAll();
}
    </script>
        
</body>
</html>